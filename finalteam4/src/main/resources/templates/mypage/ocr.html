<meta charset="utf-8">
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<style>
.navigation {
	position: relative;
}

/* Sidebar */
#sidebar-wrapper {
	z-index: 1;
	position: absolute;
	width: 0;
	height: 150%;
	overflow-y: hidden;
	opacity: 0.9;
	transition: all .5s;
	display: flex;
	padding-left: 40px;
}

/* Main Content */
#page-content-wrapper {
	width: 100%;
	padding: 15px;
	transition: all .5s;
}

#menu-toggle {
	transition: all .3s;
	font-size: 20px;
}
/* Change the width of the sidebar to display it*/
#wrapper.menuDisplayed #sidebar-wrapper {
	width: 250px;
}

#wrapper.menuDisplayed #page-content-wrapper {
	padding-left: 250px;
}

/* Sidebar styling */
.sidebar-nav {
	padding: 0;
	list-style: none;
	transition: all .5s;
	width: 100%;
	text-align: center;
}

.sidebar-nav li {
	line-height: 40px;
	width: 100%;
	transition: all .3s;
	padding: 10px 0;
}

.sidebar-nav li a {
	font-size: 15px;
	color: #5d5d5d;
	font-weight: 200;
}

.sidebar-nav li h4 {
	font-size: 17px;
	line-height: 26px;
	font-weight: 800;
	color: #303033;
}

/* .sidebar-nav li {
	
} */
.footer-style-3 {
	display: none;
}

.weather-card {
	margin: 0px auto;
	height: 180px;
	width: 900px;
	background: #fff;
	box-shadow: 0 1px 38px rgba(0, 0, 0, 0.15), 0 5px 12px
		rgba(0, 0, 0, 0.25);
	overflow: hidden;
}

.weather-card .top {
	position: relative;
	height: 220px;
	width: 100%;
	overflow: hidden;
	background: url("/img/mypage_recent.jpg") no-repeat;
	background-size: cover;
	background-position: center center;
	text-align: center;
	background-size: cover;
}

.weather-card .top .wrapper {
	padding: 0px;
	position: relative;
	z-index: 1;
	width: 50%;
	float: right;
}

.weather-card .top .wrapper2 {
	padding: 0px;
	position: relative;
	z-index: 1;
	width: 50%;
	float: left;
}

.weather-card .top .wrapper .mynav {
	height: 10px;
}

.weather-card .top .wrapper .mynav .lnr {
	color: #fff;
	font-size: 20px;
}

.weather-card .top .wrapper .mynav .lnr-chevron-left {
	display: inline-block;
	float: left;
}

.weather-card .top .wrapper .mynav .lnr-cog {
	display: inline-block;
	float: right;
}

.weather-card .top .wrapper .heading {
	margin-top: 10px;
	font-size: 35px;
	font-weight: 400;
	color: #fff;
}

.weather-card .top .wrapper .location {
	margin-top: 20px;
	font-size: 20px;
	color: #fff;
}

.weather-card .top .wrapper .temp {
	margin-top: 20px;
}

.weather-card .top .wrapper .temp a {
	text-decoration: none;
	color: #fff;
}

.weather-card .top .wrapper .temp a .temp-type {
	font-size: 85px;
}

.weather-card .top .wrapper .temp .temp-value {
	display: inline-block;
	font-size: 50px;
	color: #fff;
}

.weather-card .top .wrapper .temp .deg {
	display: inline-block;
	font-size: 35px;
	font-weight: 600;
	color: #fff;
	vertical-align: top;
	margin-top: 10px;
}

.weather-card .top:after {
	content: "";
	height: 100%;
	width: 100%;
	display: block;
	position: absolute;
	top: 0;
	left: 0;
	background: rgba(0, 0, 0, 0.5);
}

.weather-card .top .wrapper2 .mynav {
	height: 20px;
}

.weather-card .top .wrapper2 .mynav .lnr {
	color: #fff;
	font-size: 20px;
}

.weather-card .top .wrapper2 .mynav .lnr-chevron-left {
	display: inline-block;
	float: left;
}

.weather-card .top .wrapper2 .mynav .lnr-cog {
	display: inline-block;
	float: right;
}

.weather-card .top .wrapper2 .heading {
	margin-top: 10px;
	font-size: 35px;
	font-weight: 400;
	color: #fff;
}

.weather-card .top .wrapper2 .location {
	margin-top: 20px;
	font-size: 20px;
	color: #fff;
}

.weather-card .top .wrapper2 .temp {
	margin-top: 20px;
}

.weather-card .top .wrapper2 .temp a {
	text-decoration: none;
	color: #fff;
}

.weather-card .top .wrapper2 .temp a .temp-type {
	font-size: 85px;
}

.weather-card .top .wrapper2 .temp .temp-value {
	display: inline-block;
	font-size: 50px;
	color: #fff;
}

.weather-card .top .wrapper2 .temp .deg {
	display: inline-block;
	font-size: 35px;
	font-weight: 600;
	color: #fff;
	vertical-align: top;
	margin-top: 10px;
}

.contents {
	margin: 0px auto;
	height: 220px;
	width: 1000px;
	padding-top: 50px;
}

.my_tit {
	position: relative;
	padding-bottom: 10px;
	border-bottom: 4px solid #000;
}

.my_tit span {
	display: inline-block;
	margin-left: 10px;
	font-size: 18px;
	font-weight: 400;
}

.btn_next {
	padding-top: 30px;
	border-top: 1px solid #d4d4d4;
	text-align: center;
}

.btn_next button {
	width: 300px;
	height: 50px;
	margin: 0 auto;
	background: #000;
}

.main_recipt {
	width: 500px;
	height: 400px;
	padding: 20px;
	float: left;
}

.label {
	width: 50px;
	height: 25px;
	cursor: pointer;
}

.main_review {
	width: 500px;
	height: 400px;
	padding: 20px;
	float: right;
}

.textarea {
	width: 460px;
	height: 400px;
	padding-top: 20px;
}

.textarea_form {
	width: 100%;
	height: 100%;
}

.review_button {
	margin-top: 12px;
	margin-left: 390px;
}

.btns {
	float: right;
	width: 96px;
	line-height: 32px;
	font-size: 18px;
	background: #FFBB45;
	border: none;
}
</style>

<script>
	var order_storename = "[[${order.storename}]]";
	var date = "[[${order.reservedate}]]";
	var order_reservedate = new Date(date.substr(0, 4), date.substr(5, 2), date
			.substr(8, 2));
	var order_reserve = order_reservedate.toString();
	var order_orderprice = "[[${total}]]";

	$(document).ready(function() {
		$("#menu-toggle").click(function(e) {
			e.preventDefault();
			$("#wrapper").toggleClass("menuDisplayed");
		});

		$("#savereview").click(function() {
			$("#review").attr({
				"action" : "/mypage/reviewregist",
				"method" : "GET"
			});
			$("#review").submit();
		});
	});

	function readURL(input) {
		var reader = new FileReader(); // File 객체를 이용해 파일의 내용을 읽고 사용자의 컴퓨터에 저장하는 것을 가능

		// FileReader.onload - load 이벤트의 핸들러, 읽기 동작이 성공적으로 완료 되었을 때마다 발생
		reader.onload = function(e) {
			$("#showimg").attr("src", e.target.result);
			$("#showimg").attr("style", "max-width: 300px;", "width:400px;");
		};
		// 컨텐츠를 File에서 읽어 오는 역할
		reader.readAsDataURL(input.files[0]);
	}

	function upload() {
		const imageInput = $("#rcpt")[0];

		if (imageInput.files.lenght === 0) {
			alert("영수증 사진을 첨부해주세요.");
			return;
		}

		const formData = new FormData();
		formData.append("image", imageInput.files[0]);

		$.ajax({
			type : "POST",
			url : "/ocr/ocrresult",
			processData : false,
			contentType : false,
			data : formData,
			success : function(data) {
				check(data);
			}
		});
	}

	function check(data) {
		var rcp_storename = data.images[0].fields[0].inferText;
		var rcp_date = data.images[0].fields[1].inferText;
		var rcp_reservedate = new Date(rcp_date.substr(0, 4), rcp_date.substr(
				5, 2), rcp_date.substr(8, 2));
		var rcp_reserve = rcp_reservedate.toString();
		var rcp_orderprice = data.images[0].fields[4].inferText;

		if (order_storename == rcp_storename && order_reserve == rcp_reserve) {
			if (order_orderprice == rcp_orderprice) {
				$("#result_msg").text("영수증 정보가 일치합니다.");
				$("#result_msg").css("color", "green");
				$("#revtext").attr("disabled", false);
				$("#savereview").attr("disabled", false);
				return

				

								

				

			} else {
				$("#result_msg").text("결제하신 내역의 정보와 상이합니다. *주문 음식 불일치");
				$("#result_msg").css("color", "#ff4800");
				return

				

								

				

			}
		} else {
			$("#result_msg").text("해당 가게의 영수증이 아니거나 결제 날짜가 맞지 않습니다.");
			$("#result_msg").css("color", "#ff4800");
			return

			

						

			

		}
	}
</script>

<body>
	<div id="wrapper">
		<!-- Sidebar -->
		<div id="sidebar-wrapper">
			<ul class="sidebar-nav">
				<li><a th:text="${session.logincust.custname}"
					style="padding: 20px 0 10px 0; font-size: 40px; font-weight: 700"></a></li>
				<li><h4 href="#">나의 EAT & OUT 정보</h4></li>
				<li><a
					th:href="@{/mypage/order(id=${session.logincust.custid})}">테이블
						조회</a></li>
				<li><a
					th:href="@{/mypage/review(id=${session.logincust.custid})}">나의
						리뷰</a></li>
				<li><a
					th:href="@{/mypage/wishlist(id=${session.logincust.custid})}">나의
						위시리스트</a></li>
				<li><h4 href="#">나의 계정설정</h4></li>
				<li><a
					th:href="@{/mypage/edit(id=${session.logincust.custid})}">회원정보수정</a></li>
				<li><a href="#">회원등급</a></li>
				<li><a href="#">쿠폰</a></li>
				<li><h4 href="#">고객센터</h4></li>
				<li><a href="#">1:1 문의내역</a></li>
				<li><a href="#">공지사항</a></li>
				<li><a href="#">FAQ</a></li>
			</ul>
		</div>

		<!-- Page Content -->
		<div id="page-content-wrapper">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<a href="#" class="btn" id="menu-toggle">메뉴 ><span
							class="glyphicon glyphicon-menu-hamburger"></span></a>
						<div class="weather-card one" th:with="list1=${list_one}">
							<div class="top">
								<div class="wrapper">
									<div class="mynav"></div>
									<h1 class="heading" th:text="${list1.storename}"></h1>
									<h3 class="location" th:text="${list1.reservedate}"></h3>
									<p class="temp">
										<span class="temp-value" th:text="${list1.reservetime}"></span>
									</p>
								</div>
								<div class="wrapper2">
									<div class="mynav"></div>
									<h2 class="heading">가까운 예약</h2>
									<h2 class="heading">D - 13</h2>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="contents">
				<h3 class="my_tit">
					영수증 체크<span>방문하신 영수증을 인증하고 리뷰를 작성해주세요.</span>
				</h3>
				<div class="main_recipt">
					<form id="uploadimg">
						<label class="label" for="rcpt">+</label> <input type="file"
							id="rcpt" onchange="readURL(this);" style="display: none">
					</form>
					<div style="text-align: center">
						<img id="showimg">
					</div>
					<div class="recipt" style="padding-top: 20px; padding-bottom: 20px">
						<div style="text-align: center">
							<span id="result_msg"></span>
						</div>
						<div>
							<button class="btns" onclick="upload()">C h e c k</button>
						</div>
					</div>
				</div>
				<div class="main_review">
					<div class="review">
						<form id="review">
							<h4 th:text="${order.storename}"
								style="padding-bottom: 12px; border-bottom: 1px solid #d4d4d4;"></h4>
							<input th:value="${order.storeid}" name="storeid"
								style="display: none"></input> <input
								th:value="${session.logincust.custid}" name="custid"
								style="display: none"></input>
							<div class="textarea">
								<textarea id="revtext" class="textarea_form" name="revtext"
									disabled></textarea>
							</div>
							<div style="margin-top: 20px">
								<select id="star" name="star">
									<option value="5">★★★★★</option>
									<option value="4">★★★★</option>
									<option value="3">★★★</option>
									<option value="2">★★</option>
									<option value="1">★</option>
								</select>
							</div>
						</form>
					</div>
					<div>
						<button class="btns" type="button" id="savereview" disabled>등록하기</button>
					</div>
				</div>
			</div>
		</div>
</body>