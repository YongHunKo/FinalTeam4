<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<meta charset="utf-8">

<head>
<link rel="stylesheet" th:href="@{/assets/css/common/styles.css}">

<style>
/* ë°°ë„ˆ */
.card2 {
	background-color: #ffffff;
	border-radius: 30px;
	background: url("/eatnout/img/caption.jpg") no-repeat;
	background-size: cover;
	background-position: center;
	margin-top: 30px;
}

#heading {
	font-size: 55px;
	color: #fff;
}

.temp {
	place-items: center;
}

.temp-details>p>span, .grey {
	color: #fff;
	font-size: 18px;
}

.fa {
	color: #fff
}

*:focus {
	outline: none;
}
.main_recipt {
	width: 500px;
	height: 400px;
	padding: 20px;
	margin-bottom: 130px;
	float: left;
}

.label {
	width: 50px;
	height: 25px;
	cursor: pointer;
}

.main_review {
	width: 500px;
	height: 600px;
	padding: 20px;
	float: left;
}

.textarea {
	width: 100%;
	height: 100%;
	padding-top: 20px;
}

.textarea_form {
	width: 100%;
	height: 400px;
}

.review_button {
	margin-top: 12px;
	margin-left: 390px;
}

.btns {
	float: right;
	width: 96px;
	line-height: 32px;
	font-size: 18px;
	background: #FFBB45;
	border: none;
}
</style>



<script>
	var order_storename = "[[${order.storename}]]";
	var date = "[[${order.reservedate}]]";
	var order_reservedate = new Date(date.substr(0, 4), date.substr(5, 2), date
			.substr(8, 2));
	var order_reserve = order_reservedate.toString();
	var order_orderprice = "[[${total}]]";

	$(document).ready(function() {
		$("#menu-toggle").click(function(e) {
			e.preventDefault();
			$("#wrapper").toggleClass("menuDisplayed");
			/* menu.style.visibility = "hidden"; */
		});

		$("#savereview").click(function() {
			$("#review").attr({
				"action" : "/mypage/reviewregist",
				"method" : "GET"
			});
			$("#review").submit();
		});

	});

	function readURL(input) {
		var reader = new FileReader(); // File ê°ì²´ë¥¼ ì´ìš©í•´ íŒŒì¼ì˜ ë‚´ìš©ì„ ì½ê³  ì‚¬ìš©ìì˜ ì»´í“¨í„°ì— ì €ì¥í•˜ëŠ” ê²ƒì„ ê°€ëŠ¥

		// FileReader.onload - load ì´ë²¤íŠ¸ì˜ í•¸ë“¤ëŸ¬, ì½ê¸° ë™ì‘ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ ë˜ì—ˆì„ ë•Œë§ˆë‹¤ ë°œìƒ
		reader.onload = function(e) {
			$("#showimg").attr("src", e.target.result);
			$("#showimg").attr("style", "height:430px; width: 360px;");
		};
		// ì»¨í…ì¸ ë¥¼ Fileì—ì„œ ì½ì–´ ì˜¤ëŠ” ì—­í• 
		reader.readAsDataURL(input.files[0]);
	}

	function upload() {
		const imageInput = $("#rcpt")[0];

		if (imageInput.files.lenght === 0) {
			alert("ì˜ìˆ˜ì¦ ì‚¬ì§„ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.");
			return;
		}

		const formData = new FormData();
		formData.append("image", imageInput.files[0]);

		$.ajax({
			url : "[[@{/ocr/ocrresult}]]",
			data : formData,
			processData : false,
			contentType : false,
			type : "POST",
			success : function(data) {
				check(data);
			}
		});
	}

	function check(data) {
		var rcp_storename = data.images[0].fields[0].inferText;
		var rcp_date = data.images[0].fields[1].inferText;
		var rcp_reservedate = new Date(rcp_date.substr(0, 4), rcp_date.substr(
				5, 2), rcp_date.substr(8, 2));
		var rcp_reserve = rcp_reservedate.toString();
		var rcp_orderprice = data.images[0].fields[4].inferText;

		if (order_storename == rcp_storename && order_reserve == rcp_reserve) {
			if (order_orderprice == rcp_orderprice) {
				$("#result_msg").text("ì˜ìˆ˜ì¦ ì •ë³´ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.");
				$("#result_msg").css("color", "green");
				$("#revtext").attr("disabled", false);
				$("#savereview").attr("disabled", false);
				return

				

			} else {
				$("#result_msg").text("ê²°ì œí•˜ì‹  ë‚´ì—­ì˜ ì •ë³´ì™€ ìƒì´í•©ë‹ˆë‹¤. *ì£¼ë¬¸ ìŒì‹ ë¶ˆì¼ì¹˜");
				$("#result_msg").css("color", "#ff4800");
				return

				

			}

		} else {
			$("#result_msg").text("í•´ë‹¹ ê°€ê²Œì˜ ì˜ìˆ˜ì¦ì´ ì•„ë‹ˆê±°ë‚˜ ê²°ì œ ë‚ ì§œê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
			$("#result_msg").css("color", "#ff4800");
			return

			

		}
	}
</script>

</head>

<body>
	<div id="wrapper" style="height: 100%">
		<!-- ë©”ë‰´ë°” -->
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<button class="navbar-toggler" type="button" data-toggle="collapse"
				data-target="#navbarSupportedContent"
				aria-controls="navbarSupportedContent" aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>


			<div class="collapse navbar-collapse" id="navbarSupportedContent" style="justify-content:center;">
				<ul class="navbar-nav">
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false">ë‚˜ì˜ EAT & OUT</a>
						<div class="dropdown-menu" aria-labelledby="navbarDropdown">
							<a class="dropdown-item"
								th:href="@{/mypage/order(id=${session.logincust.custid})}">í…Œì´ë¸”
								ì¡°íšŒ</a> <a class="dropdown-item"
								th:href="@{/mypage/review(id=${session.logincust.custid})}">ë‚˜ì˜
								ë¦¬ë·°</a> <a class="dropdown-item"
								th:href="@{/wishlist(id=${session.logincust.custid})}">ë‚˜ì˜
								ìœ„ì‹œë¦¬ìŠ¤íŠ¸</a>
						</div></li>
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false"> ê³„ì •ì„¤ì • </a>
						<div class="dropdown-menu" aria-labelledby="navbarDropdown">
							<a class="dropdown-item"
								th:href="@{/mypage/edit(id=${session.logincust.custid})}">íšŒì›ì •ë³´ìˆ˜ì •</a>
							<a class="dropdown-item" href="#">ì¿ í°</a>
						</div></li>
					<li class="nav-item dropdown"><a
						class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
						role="button" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false">ê³ ê°ì„¼í„°</a>
						<div class="dropdown-menu" aria-labelledby="navbarDropdown">
							<a class="dropdown-item" th:href="@{/mypage/question}">1:1
								ë¬¸ì˜ë‚´ì—­</a> <a class="dropdown-item" href="#">ê³µì§€ì‚¬í•­</a> <a
								class="dropdown-item" href="#">FAQ</a>
						</div></li>
				</ul>
			</div>
		</nav>
		<!-- ë©”ë‰´ë°” ë -->
		<div class="container-fluid">

		<div class="row justify-content-center">
			<div class="col-12 col-md-4 col-sm-12 col-xs-12">
				<div class="card2 p-4">
					<div class="d-flex">
						<h6 class="flex-grow-1" style="color: #fff;"
							th:text="'ğŸ˜€'+${session.logincust.custname}+'ë‹˜ì˜ ê°€ê¹Œìš´ ì˜ˆì•½'"></h6>
						<h6></h6>
					</div>
					<div class="d-flex flex-column temp mt-5 mb-3"
						th:with="list1 = ${session.list_one}">
						<h3 class="mb-0 font-weight-bold" id="heading"
							th:text="${list1.storename}"></h3>
					</div>
					<div class="d-flex" th:with="list1 = ${session.list_one}">
						<div class="temp-details flex-grow-1">
							<p class="my-1" th:text="'D' + ${session.banner_dday}"
								style="color: #fff; font-size: 15px;">
								<span th:text="${session.banner_rsvdate}"
									style="color: #fff; font-size: 45px;"></span>
							</p>
							<p class="my-1">
								<span th:text="'ì˜ˆì•½ë‚ ì§œ : '+${list1.reservedate}"
									style="color: #fff;"> </span>
							</p>
						</div>
						<div></div>
					</div>
				</div>
			</div>
		</div>
	</div>
		
		<div id="page-content-wrapper">
			<div class="container-fluid px-1 px-md-4 py-2 mx-auto">
				<div class="row d-flex justify-content-center px-3">
					<h3 class="my_tit">
						ì˜ìˆ˜ì¦ ì²´í¬<span>ë°©ë¬¸í•˜ì‹  ì˜ìˆ˜ì¦ì„ ì¸ì¦í•˜ê³  ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.</span>
					</h3>
				</div>
				<div class="row">
					<div class="main_recipt">
						<form id="uploadimg">
							<label class="label" for="rcpt">+</label> <input type="file"
				
								id="rcpt" onchange="readURL(this);" style="display: none">
						</form>
						<div style="width: 200px; height: 200px;">
							<img id="showimg" style="height: 400px">
						</div>
						<div class="recipt"
							style="padding-top: 20px; padding-bottom: 20px">
							<div style="text-align: center">
								<span id="result_msg"></span>
							</div>
							<div>
								<button class="btns" onclick="upload()">C h e c k</button>
							</div>
						</div>
					</div>
					<div class="main_review">
						<div class="review">
							<form id="review">
								<h4 th:text="${order.storename}"
									style="padding-bottom: 12px; border-bottom: 1px solid #d4d4d4;"></h4>
								<input th:value="${order.storeid}" name="storeid"
									style="display: none"></input> <input
									th:value="${session.logincust.custid}" name="custid"
									style="display: none"></input>
								<div class="textarea">
									<textarea id="revtext" class="textarea_form" name="revtext"
										disabled></textarea>
								</div>
								<div style="margin-top: 20px">
									<select id="star" name="star">
										<option value="5">â˜…â˜…â˜…â˜…â˜…</option>
										<option value="4">â˜…â˜…â˜…â˜…</option>
										<option value="3">â˜…â˜…â˜…</option>
										<option value="2">â˜…â˜…</option>
										<option value="1">â˜…</option>
									</select>
								</div>
							</form>
							<div>
								<button class="btns" type="button" id="savereview" disabled>ë“±ë¡í•˜ê¸°</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>
